const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BrKJ-MAD.js","assets/index-CSl2CzVt.js","assets/index-B6sON4Y2.css"])))=>i.map(i=>d[i]);
import{ap as se,aq as ne,b as d,as as c,ar as ie,aF as le,w as B,at as x,d as s,au as a,av as u,ax as G,ay as ce,aw as n,az as v,aA as p,aC as E,aD as O,aE as re,aG as U}from"./index-CSl2CzVt.js";import{u as de}from"./order-DhN_UaYP.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve="data:image/svg+xml,%3csvg%20width='128'%20height='128'%20viewBox='0%200%20128%20128'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='g1'%20x1='0'%20x2='1'%20y1='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23FF8A00'/%3e%3cstop%20offset='100%25'%20stop-color='%23FF3D68'/%3e%3c/linearGradient%3e%3clinearGradient%20id='g2'%20x1='0'%20x2='1'%20y1='1'%20y2='0'%3e%3cstop%20offset='0%25'%20stop-color='%23FFD7A2'/%3e%3cstop%20offset='100%25'%20stop-color='%23FFC0CC'/%3e%3c/linearGradient%3e%3clinearGradient%20id='g3'%20x1='0'%20x2='1'%20y1='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%23FFA726'/%3e%3cstop%20offset='100%25'%20stop-color='%23FF7043'/%3e%3c/linearGradient%3e%3cfilter%20id='shadow'%20x='-20%25'%20y='-20%25'%20width='140%25'%20height='140%25'%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='4'%20flood-color='%23ff9f6a'%20flood-opacity='0.35'/%3e%3c/filter%3e%3c/defs%3e%3c!--%20房屋主体%20--%3e%3crect%20x='12'%20y='60'%20width='104'%20height='52'%20rx='10'%20fill='%23fff'%20stroke='url(%23g1)'%20stroke-width='4'%20filter='url(%23shadow)'/%3e%3c!--%20屋顶%20--%3e%3cpath%20d='M64%2018%20L16%2052%20L24%2052%20L24%2060%20L104%2060%20L104%2052%20L112%2052%20Z'%20fill='url(%23g1)'%20opacity='0.25'/%3e%3c!--%20房门%20--%3e%3cpath%20d='M64%2030%20L28%2056%20L28%20108%20L100%20108%20L100%2056%20Z'%20fill='%23fff'%20stroke='url(%23g1)'%20stroke-width='3'/%3e%3c!--%20心形装饰%20--%3e%3cpath%20d='M64%2048%20C54%2036%2036%2040%2032%2056%20C30%2064%2036%2076%2064%2092%20C92%2076%2098%2064%2096%2056%20C92%2040%2074%2036%2064%2048%20Z'%20fill='url(%23g2)'%20stroke='url(%23g1)'%20stroke-width='2'/%3e%3c!--%20屋顶装饰%20--%3e%3ccircle%20cx='64'%20cy='18'%20r='6'%20fill='url(%23g1)'/%3e%3c!--%20窗户%20--%3e%3crect%20x='35'%20y='70'%20width='20'%20height='20'%20rx='3'%20fill='url(%23g2)'%20stroke='url(%23g3)'%20stroke-width='2'/%3e%3crect%20x='73'%20y='70'%20width='20'%20height='20'%20rx='3'%20fill='url(%23g2)'%20stroke='url(%23g3)'%20stroke-width='2'/%3e%3c!--%20窗户十字%20--%3e%3cline%20x1='45'%20y1='70'%20x2='45'%20y2='90'%20stroke='url(%23g3)'%20stroke-width='2'/%3e%3cline%20x1='35'%20y1='80'%20x2='55'%20y2='80'%20stroke='url(%23g3)'%20stroke-width='2'/%3e%3cline%20x1='83'%20y1='70'%20x2='83'%20y2='90'%20stroke='url(%23g3)'%20stroke-width='2'/%3e%3cline%20x1='73'%20y1='80'%20x2='93'%20y2='80'%20stroke='url(%23g3)'%20stroke-width='2'/%3e%3c/svg%3e",fe="data:image/svg+xml,%3csvg%20width='128'%20height='96'%20viewBox='0%200%20128%2096'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='bg'%20x1='0'%20x2='1'%20y1='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%237AD3E7'/%3e%3cstop%20offset='100%25'%20stop-color='%23A78BFA'/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20x='0'%20y='0'%20width='128'%20height='96'%20rx='12'%20fill='url(%23bg)'/%3e%3cg%20fill='%23fff'%20stroke='%23fff'%20stroke-width='1.5'%20opacity='0.95'%3e%3cpath%20d='M24%2062%20C24%2074%20104%2074%20104%2062%20C88%2062%2072%2054%2064%2046%20C56%2054%2040%2062%2024%2062%20Z'/%3e%3cpath%20d='M40%2030%20L42%2028%20L80%2056%20L78%2058%20Z'/%3e%3cpath%20d='M48%2024%20L50%2022%20L88%2050%20L86%2052%20Z'/%3e%3c/g%3e%3c/svg%3e",he={class:"order"},me={class:"family-header"},_e={class:"family-info"},pe={class:"family-name"},ge={class:"family-date"},ye={class:"main-content"},we={class:"menu-container"},xe={class:"dish-list-container"},be={class:"dish-grid"},ke={class:"dish-image-container"},Ce={class:"image-placeholder"},De={class:"image-placeholder"},Le={class:"dish-info"},Fe={class:"dish-name"},Se={class:"dish-category"},Me={class:"dish-actions"},Ve={class:"order-summary"},Ae={class:"summary-item"},Be={class:"summary-item"},Ge={class:"submit-tip"},Ee=se({__name:"Order",setup(Oe){var M;const D=ce(),L=le(),g=ne(),b=de(),I=d(ve),Z=d("温馨小家"),i=d("lunch"),q=c(()=>({breakfast:"早餐",lunch:"午餐",dinner:"晚餐"})[i.value]),y=d(!1),k=c(()=>g.next7Days());function z(e){const t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),h=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(r,"-").concat(h)}const l=d(((M=k.value[0])==null?void 0:M.value)||z(new Date)),N=c(()=>{var e;return((e=k.value.find(t=>t.value===l.value))==null?void 0:e.label)||"今天"});function T(){y.value=!0}const $=c(()=>k.value.map(e=>({name:e.label,value:e.value})));function R(e){l.value=e.value,y.value=!1,w()}const C=d(0),F=c(()=>g.categories);function P(e){const t=b.getCounts(l.value,i.value),h=g.dishes.filter(m=>m.categoryId===e).reduce((m,_)=>m+(t[_.id]||0),0);return h>0?h:void 0}const j=c(()=>{const e=F.value[C.value];return g.dishes.filter(t=>t.categoryId===(e==null?void 0:e.id))}),f=d({});function w(){f.value=b.getCounts(l.value,i.value)}function H(e,t){b.setCount(l.value,i.value,e,t||0)}const Q=c(()=>Object.values(f.value).filter(e=>e>0).length),S=c(()=>Object.values(f.value).reduce((e,t)=>e+(t||0),0));async function Y(){try{U(async()=>{const{showToast:e}=await import("./index-BrKJ-MAD.js");return{showToast:e}},__vite__mapDeps([0,1,2])).then(({showToast:e})=>e({message:"点餐提交成功！",type:"success",duration:1500})),setTimeout(()=>{D.push("/")},1500)}catch(e){U(async()=>{const{showToast:t}=await import("./index-BrKJ-MAD.js");return{showToast:t}},__vite__mapDeps([0,1,2])).then(({showToast:t})=>t({message:"提交失败，请重试",type:"fail"}))}}function J(){const e=new Date().getHours();return e<10?"breakfast":e<16?"lunch":"dinner"}return ie(()=>{const e=L.query.date||l.value;l.value=e;const t=L.query.meal;i.value=t||J(),w()}),B(i,()=>{w()}),B(l,()=>{w()}),(e,t)=>{const r=n("van-icon"),h=n("van-nav-bar"),m=n("van-image"),_=n("van-tab"),K=n("van-tabs"),W=n("van-sidebar-item"),X=n("van-sidebar"),ee=n("van-stepper"),te=n("van-list"),ae=n("van-submit-bar"),oe=n("van-action-sheet");return p(),x("div",he,[s(h,{title:"点餐","left-arrow":"",fixed:"",placeholder:"",onClickLeft:t[0]||(t[0]=o=>G(D).go(-1))},{right:u(()=>[s(r,{name:"calendar-o",size:"20",onClick:T})]),_:1}),a("div",me,[s(m,{src:I.value,width:"40",height:"40",round:""},null,8,["src"]),a("div",_e,[a("div",pe,v(Z.value),1),a("div",ge,v(N.value)+" · "+v(q.value),1)])]),s(K,{active:i.value,"onUpdate:active":t[1]||(t[1]=o=>i.value=o),class:"meal-tabs",type:"card",color:"#1989fa",background:"#f5f5f5",animated:""},{default:u(()=>[s(_,{title:"早餐",name:"breakfast"}),s(_,{title:"午餐",name:"lunch"}),s(_,{title:"晚餐",name:"dinner"})]),_:1},8,["active"]),a("div",ye,[a("div",we,[s(X,{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=o=>C.value=o),class:"category-sidebar"},{default:u(()=>[(p(!0),x(E,null,O(F.value,o=>(p(),re(W,{key:o.id,title:o.name,badge:P(o.id)},null,8,["title","badge"]))),128))]),_:1},8,["modelValue"]),a("div",xe,[s(te,{"finished-text":"没有更多了"},{default:u(()=>[a("div",be,[(p(!0),x(E,null,O(j.value,o=>(p(),x("div",{key:o.id,class:"dish-card"},[a("div",ke,[s(m,{src:o.imageUrl||G(fe),width:"100%",height:"120",fit:"cover",radius:"12"},{loading:u(()=>[a("div",Ce,[s(r,{name:"photo",size:"24",color:"#ccc"})])]),error:u(()=>[a("div",De,[s(r,{name:"photo-fail",size:"24",color:"#ccc"})])]),_:1},8,["src"])]),a("div",Le,[a("div",Fe,v(o.name),1),a("div",Se,v(o.categoryName),1),a("div",Me,[s(ee,{modelValue:f.value[o.id],"onUpdate:modelValue":V=>f.value[o.id]=V,integer:"",min:"0",max:"99",theme:"round","button-size":"24",onChange:V=>{var A;return H(o.id,(A=f.value[o.id])!=null?A:0)}},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]))),128))])]),_:1})])]),a("div",Ve,[a("div",Ae,[t[4]||(t[4]=a("span",null,"已选菜品",-1)),a("span",null,v(Q.value)+" 道",1)]),a("div",Be,[t[5]||(t[5]=a("span",null,"总计份数",-1)),a("span",null,v(S.value)+" 份",1)])])]),s(ae,{price:S.value*100,"button-text":"提交点餐",onSubmit:Y,"safe-area-inset-bottom":""},{tip:u(()=>[a("div",Ge,[s(r,{name:"info-o"}),t[6]||(t[6]=a("span",null,"提交后可在食谱页面查看",-1))])]),_:1},8,["price"]),s(oe,{show:y.value,"onUpdate:show":t[3]||(t[3]=o=>y.value=o),actions:$.value,"cancel-text":"取消",onSelect:R,"close-on-click-action":""},null,8,["show","actions"])])}}}),qe=ue(Ee,[["__scopeId","data-v-c67241cc"]]);export{qe as default};
