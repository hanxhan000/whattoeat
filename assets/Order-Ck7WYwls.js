const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DsuK2-U_.js","assets/index-C7dpphAl.js","assets/index-CWTlJwoP.css"])))=>i.map(i=>d[i]);
import{an as se,b as u,ap as c,ao as oe,aC as le,w as O,aq as w,d as s,ar as a,as as d,au as U,av as ie,at as o,aw as v,ax as h,az as E,aA as I,aB as ce,aD as q}from"./index-C7dpphAl.js";import{u as re,a as ue,_ as de}from"./_plugin-vue_export-helper-CqNKRwdv.js";import{l as ve}from"./logo-family-Cax3AFxD.js";const _e="data:image/svg+xml,%3csvg%20width='128'%20height='96'%20viewBox='0%200%20128%2096'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='bg'%20x1='0'%20x2='1'%20y1='0'%20y2='1'%3e%3cstop%20offset='0%25'%20stop-color='%237AD3E7'/%3e%3cstop%20offset='100%25'%20stop-color='%23A78BFA'/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20x='0'%20y='0'%20width='128'%20height='96'%20rx='12'%20fill='url(%23bg)'/%3e%3cg%20fill='%23fff'%20stroke='%23fff'%20stroke-width='1.5'%20opacity='0.95'%3e%3cpath%20d='M24%2062%20C24%2074%20104%2074%20104%2062%20C88%2062%2072%2054%2064%2046%20C56%2054%2040%2062%2024%2062%20Z'/%3e%3cpath%20d='M40%2030%20L42%2028%20L80%2056%20L78%2058%20Z'/%3e%3cpath%20d='M48%2024%20L50%2022%20L88%2050%20L86%2052%20Z'/%3e%3c/g%3e%3c/svg%3e",me={class:"order"},fe={class:"family-header"},pe={class:"family-info"},he={class:"family-name"},ge={class:"family-date"},ye={class:"main-content"},be={class:"menu-container"},we={class:"dish-list-container"},Ce={class:"dish-grid"},De={class:"dish-image-container"},xe={class:"image-placeholder"},ke={class:"image-placeholder"},Le={class:"dish-info"},Se={class:"dish-name"},Ve={class:"dish-category"},Me={class:"dish-actions"},Be={class:"order-summary"},Ae={class:"summary-item"},Oe={class:"summary-item"},Ue={class:"submit-tip"},Ee=se({__name:"Order",setup(Ie){var M;const k=ie(),L=le(),g=re(),C=ue(),z=u(ve),N=u("温馨小家"),l=u("lunch"),T=c(()=>({breakfast:"早餐",lunch:"午餐",dinner:"晚餐"})[l.value]),y=u(!1),D=c(()=>g.next7Days());function $(e){const t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),m=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(r,"-").concat(m)}const i=u(((M=D.value[0])==null?void 0:M.value)||$(new Date)),R=c(()=>{var e;return((e=D.value.find(t=>t.value===i.value))==null?void 0:e.label)||"今天"});function F(){y.value=!0}const P=c(()=>D.value.map(e=>({name:e.label,value:e.value})));function Z(e){i.value=e.value,y.value=!1,b()}const x=u(0),S=c(()=>g.categories);function j(e){const t=C.getCounts(i.value,l.value),m=g.dishes.filter(f=>f.categoryId===e).reduce((f,p)=>f+(t[p.id]||0),0);return m>0?m:void 0}const G=c(()=>{const e=S.value[x.value];return g.dishes.filter(t=>t.categoryId===(e==null?void 0:e.id))}),_=u({});function b(){_.value=C.getCounts(i.value,l.value)}function H(e,t){C.setCount(i.value,l.value,e,t||0)}const Q=c(()=>Object.values(_.value).filter(e=>e>0).length),V=c(()=>Object.values(_.value).reduce((e,t)=>e+(t||0),0));async function Y(){try{q(async()=>{const{showToast:e}=await import("./index-DsuK2-U_.js");return{showToast:e}},__vite__mapDeps([0,1,2])).then(({showToast:e})=>e({message:"点餐提交成功！",type:"success",duration:1500})),setTimeout(()=>{k.push("/")},1500)}catch(e){q(async()=>{const{showToast:t}=await import("./index-DsuK2-U_.js");return{showToast:t}},__vite__mapDeps([0,1,2])).then(({showToast:t})=>t({message:"提交失败，请重试",type:"fail"}))}}function J(){const e=new Date().getHours();return e<10?"breakfast":e<16?"lunch":"dinner"}return oe(()=>{const e=L.query.date||i.value;i.value=e;const t=L.query.meal;l.value=t||J(),b()}),O(l,()=>{b()}),O(i,()=>{b()}),(e,t)=>{const r=o("van-icon"),m=o("van-nav-bar"),f=o("van-image"),p=o("van-tab"),K=o("van-tabs"),W=o("van-sidebar-item"),X=o("van-sidebar"),ee=o("van-stepper"),te=o("van-list"),ae=o("van-submit-bar"),ne=o("van-action-sheet");return h(),w("div",me,[s(m,{title:"点餐","left-arrow":"",fixed:"",placeholder:"",onClickLeft:t[0]||(t[0]=n=>U(k).go(-1))},{right:d(()=>[s(r,{name:"calendar-o",size:"20",onClick:F})]),_:1}),a("div",fe,[s(f,{src:z.value,width:"40",height:"40",round:""},null,8,["src"]),a("div",pe,[a("div",he,v(N.value),1),a("div",ge,v(R.value)+" · "+v(T.value),1)])]),s(K,{active:l.value,"onUpdate:active":t[1]||(t[1]=n=>l.value=n),class:"meal-tabs",type:"card",color:"#1989fa",background:"#f5f5f5",animated:""},{default:d(()=>[s(p,{title:"早餐",name:"breakfast"}),s(p,{title:"午餐",name:"lunch"}),s(p,{title:"晚餐",name:"dinner"})]),_:1},8,["active"]),a("div",ye,[a("div",be,[s(X,{modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=n=>x.value=n),class:"category-sidebar"},{default:d(()=>[(h(!0),w(E,null,I(S.value,n=>(h(),ce(W,{key:n.id,title:n.name,badge:j(n.id)},null,8,["title","badge"]))),128))]),_:1},8,["modelValue"]),a("div",we,[s(te,{"finished-text":"没有更多了"},{default:d(()=>[a("div",Ce,[(h(!0),w(E,null,I(G.value,n=>(h(),w("div",{key:n.id,class:"dish-card"},[a("div",De,[s(f,{src:n.imageUrl||U(_e),width:"100%",height:"120",fit:"cover",radius:"12"},{loading:d(()=>[a("div",xe,[s(r,{name:"photo",size:"24",color:"#ccc"})])]),error:d(()=>[a("div",ke,[s(r,{name:"photo-fail",size:"24",color:"#ccc"})])]),_:1},8,["src"])]),a("div",Le,[a("div",Se,v(n.name),1),a("div",Ve,v(n.categoryName),1),a("div",Me,[s(ee,{modelValue:_.value[n.id],"onUpdate:modelValue":B=>_.value[n.id]=B,integer:"",min:"0",max:"99",theme:"round","button-size":"24",onChange:B=>{var A;return H(n.id,(A=_.value[n.id])!=null?A:0)}},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]))),128))])]),_:1})])]),a("div",Be,[a("div",Ae,[t[4]||(t[4]=a("span",null,"已选菜品",-1)),a("span",null,v(Q.value)+" 道",1)]),a("div",Oe,[t[5]||(t[5]=a("span",null,"总计份数",-1)),a("span",null,v(V.value)+" 份",1)])])]),s(ae,{price:V.value*100,"button-text":"提交点餐",onSubmit:Y,"safe-area-inset-bottom":""},{tip:d(()=>[a("div",Ue,[s(r,{name:"info-o"}),t[6]||(t[6]=a("span",null,"提交后可在食谱页面查看",-1))])]),_:1},8,["price"]),s(ne,{show:y.value,"onUpdate:show":t[3]||(t[3]=n=>y.value=n),actions:P.value,"cancel-text":"取消",onSelect:Z,"close-on-click-action":""},null,8,["show","actions"])])}}}),Te=de(Ee,[["__scopeId","data-v-148102c7"]]);export{Te as default};
