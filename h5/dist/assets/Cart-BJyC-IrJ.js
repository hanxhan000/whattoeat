import{aJ as L,aq as P,ap as U,as as b,b as w,at as x,d as i,au as q,av as C,ax as j,ay as M,aw as u,az as O,aI as Q,aA as k,aB as F,aC as J,aD as R,aE as T}from"./index-CYOHEeXN.js";import{u as G}from"./order-BknwCu4h.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";function K(t){var o;return typeof t=="string"?{name:t,quantity:1}:{name:t.name,quantity:(o=t.quantity)!=null?o:1,unit:t.unit}}const W=L("cart",{state:()=>({purchased:{}}),actions:{togglePurchased(t,o){this.purchased[t]||(this.purchased[t]={}),this.purchased[t][o]=!this.purchased[t][o]},clearPurchased(t){this.purchased[t]={}},aggregate(t){const o=G(),D=P(),d=["breakfast","lunch","dinner"],l=new Map;for(const a of d){const v=o.getCounts(t,a);for(const[f,h]of Object.entries(v)){if(h<=0)continue;const s=D.dishes.find(m=>m.id===f);!s||!s.ingredients||s.ingredients.length===0||s.ingredients.forEach(m=>{const{name:p,quantity:_,unit:y}=K(m),g=_*h,r=l.get(p);r?(r.quantity+=g,r.unit!==y&&(r.unit=void 0),r.fromDishes.includes(s.name)||r.fromDishes.push(s.name)):l.set(p,{name:p,quantity:g,unit:y,fromDishes:[s.name]})})}}return Array.from(l.values()).sort((a,v)=>a.name.localeCompare(v.name))}}}),X={class:"cart"},Y={class:"header"},Z={class:"date"},ee={class:"main-content"},te={key:0,class:"empty"},ne=U({__name:"Cart",setup(t){var S;const o=M(),D=P(),d=W(),l=b(()=>D.next7Days()),a=w(((S=l.value[0])==null?void 0:S.value)||""),v=b(()=>{var e;return((e=l.value.find(n=>n.value===a.value))==null?void 0:e.label)||"今天"}),f=b(()=>d.aggregate(a.value));function h(e){return e.unit?"".concat(e.quantity).concat(e.unit):"".concat(e.quantity,"份")}function s(e){var n;return!!((n=d.purchased[a.value])!=null&&n[e])}function m(e){d.togglePurchased(a.value,e)}function p(){d.clearPurchased(a.value)}const _=w(!1),y=b(()=>l.value.map(e=>({name:e.label,value:e.value})));function g(){_.value=!0}function r(e){a.value=e.value}return(e,n)=>{const V=u("van-icon"),B=u("van-nav-bar"),z=u("van-button"),I=u("van-checkbox"),N=u("van-cell"),$=u("van-cell-group"),A=u("van-empty"),E=u("van-action-sheet");return k(),x("div",X,[i(B,{title:"购物清单","left-arrow":"",fixed:"",placeholder:"",onClickLeft:n[0]||(n[0]=c=>j(o).go(-1))},{right:C(()=>[i(V,{name:"calendar-o",size:"20",onClick:g})]),_:1}),q("div",Y,[q("div",Z,O(v.value),1),i(z,{type:"primary",size:"small",round:"",onClick:p},{default:C(()=>[...n[2]||(n[2]=[F("清除已购标记",-1)])]),_:1})]),q("div",ee,[i($,{inset:""},{default:C(()=>[(k(!0),x(J,null,R(f.value,c=>(k(),T(N,{key:c.name,title:c.name,value:h(c),label:c.fromDishes.join("，")},{icon:C(()=>[i(I,{"model-value":s(c.name),"onUpdate:modelValue":()=>m(c.name)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["title","value","label"]))),128))]),_:1}),f.value.length===0?(k(),x("div",te,[i(A,{description:"今天暂无点餐，去点餐吧"})])):Q("",!0)]),i(E,{show:_.value,"onUpdate:show":n[1]||(n[1]=c=>_.value=c),actions:y.value,"cancel-text":"取消",onSelect:r,"close-on-click-action":""},null,8,["show","actions"])])}}}),ce=H(ne,[["__scopeId","data-v-ebc6f843"]]);export{ce as default};
